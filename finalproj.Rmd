--- 
title: "US import and export analysis"
author: "Yudong Zhou & Yanbo Wang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

In this project, we are gonna mainly analyze these three following problems:

1. Analyze the development process of U.S. export data from multiple perspectives such as merchandise, daily necessities, and industrial materials. Visualize the development of different industries to check whether does there exist developing trends.

2. Analyze the data of import and export cooperation between the United States and different countries. Visualize the data to find out whether there are some similarities and differences between the cooperation.

3. Analyze U.S. export data to China. After the data wrangling and visualization, check if there exists changes in export structure before and after the Sino-U.S. trade war.

Also our work will focus on several parts shown below:

a. Basic data analysis and data wrangling, including multivariate data and time series data.

b. Basic data visualization, including barplot and boxplot to figure out relationships with and between multivariate data, and zigzag lines to demonstrate changing trend of time series data.

c. Advanced data visualization, including interactive relationship plots, geographic maps, interactive heatmaps and linear model analysis graphs.

d. Comparisons and summaries based on data analysis and exploratory data analysis.


<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources
The data for our project was obtained from this website:
https://fred.stlouisfed.org/categories/16?t=goods&rt=goods&ob=pv&od=desc

## Question1: Analyze the development process of U.S. export data
Overall data of US exports of goods and services
https://fred.stlouisfed.org/series/IEAXGS

Overall data of US exports of goods
https://fred.stlouisfed.org/series/IEAXG

Overall data of US exports of services
https://fred.stlouisfed.org/series/IEAXS

Exports of Goods: General merchandise
https://fred.stlouisfed.org/series/IEAXGM

Exports of Goods: General Merchandise: Automotive vehicles, parts, and engines 
https://fred.stlouisfed.org/series/IEAXGAV

Exports of Goods: General Merchandise: Capital goods except automotive
https://fred.stlouisfed.org/series/IEAXGC

Exports of Goods: General Merchandise: Consumer goods except food and automotive
https://fred.stlouisfed.org/series/IEAXGCGA

Exports of Goods: General Merchandise: Foods, feeds, and beverages
https://fred.stlouisfed.org/series/IEAXGFA

Exports of Goods: General Merchandise: Industrial supplies and materials
https://fred.stlouisfed.org/series/IEAXGI

## Question 2: Analyze the import and export cooperation between the United States and different areas and countries.

### Islands and areas within the United States

Exports of goods for U.S. Virgin Islands https://fred.stlouisfed.org/series/EXPTOTVI

Exports of goods: manufactured commodities for U.S. Virgin Island https://fred.stlouisfed.org/series/EXPMANVI

Exports of goods: non-manufactured commodities for U.S. Virgin Island https://fred.stlouisfed.org/series/EXPNONVI


Exports of goods for Puerto Rico https://fred.stlouisfed.org/series/EXPNONPR

Exports of goods: manufactured commodities for Puerto Rico https://fred.stlouisfed.org/series/EXPMANPR

Exports of goods: non-manufactured commodities for Puerto Rico https://fred.stlouisfed.org/series/EXPNONPR


### Countries bordering the United States

Exports of goods by F.A.S. basis to Canada https://fred.stlouisfed.org/series/EXPNONVI

Exports of goods by F.A.S. basis to Mexico https://fred.stlouisfed.org/series/EXPMX


### Countries in Europe

Exports of goods by F.A.S. basis to France https://fred.stlouisfed.org/series/EXPFR

Exports of goods by F.A.S. basis to Germany https://fred.stlouisfed.org/series/EXPGE


### Countries in Asia

Exports of goods by F.A.S. basis to Japan https://fred.stlouisfed.org/series/EXPJP

Exports of goods by F.A.S. basis to South Korea https://fred.stlouisfed.org/series/EXPJP


## Question3: Analyze U.S. export data to China and import data from China

U.S. Exports of Goods by F.A.S. Basis to Mainland China
https://fred.stlouisfed.org/series/EXPCH

U.S. Imports of Goods by Customs Basis from China
https://fred.stlouisfed.org/series/IMPCH






<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

## Question1: Analyze the development process of U.S. export data

### Overall trend in data of exports of goods and services

Transformation of overall data of US exports of goods and services
```{r}
library(tidyverse)
library(readxl)
overall_data_exports_goods_services<-read_excel(here::here("IEAXGS.xls"))
overall_data_exports_goods_services<-overall_data_exports_goods_services[-(1:10),]
colnames(overall_data_exports_goods_services)<-c("Date","Goods and services")
overall_data_exports_goods_services<-overall_data_exports_goods_services%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of overall data of US exports of goods
```{r}
overall_data_exports_goods<-read_excel(here::here("IEAXG.xls"))
overall_data_exports_goods<-overall_data_exports_goods[-(1:10),]
colnames(overall_data_exports_goods)<-c("Date","Goods")
overall_data_exports_goods<-overall_data_exports_goods%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of overall data of US exports of services
```{r}
overall_data_exports_services<-read_excel(here::here("IEAXS.xls"))
overall_data_exports_services<-overall_data_exports_services[-(1:10),]
colnames(overall_data_exports_services)<-c("Date","Services")
overall_data_exports_services<-overall_data_exports_services%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Join the above three data sets
```{r}
Overall<-left_join(overall_data_exports_goods_services,overall_data_exports_goods)
Overall<-left_join(Overall,overall_data_exports_services)
Overall<-Overall%>%
  gather(key=Name,value=Value,-Date)%>%
  mutate(Name=forcats::fct_reorder2(Name,Date,Value))%>%
  mutate(Value=as.numeric(Value))
```

Transformation of the data of general merchandise
```{r}
general_merchandise<-read_excel(here::here("IEAXGM.xls"))
general_merchandise<-general_merchandise[-(1:10),]
colnames(general_merchandise)<-c("Date","General_merchandise")
general_merchandise<-general_merchandise%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Join the data sets of general merchandise and goods
```{r}
Overall_goods_general_merchandise<-left_join(overall_data_exports_goods,general_merchandise)
Overall_goods_general_merchandise<-Overall_goods_general_merchandise%>%
  gather(key=Name,value=Value,-Date)%>%
  mutate(Name=forcats::fct_reorder2(Name,Date,Value))%>%
  mutate(Value=as.numeric(Value))
```

Transformation of the data of general merchandise: Automotive vehicles, parts, and engines 
```{r}
gm_avpe<-read_excel(here::here("IEAXGAV.xls"))
gm_avpe<-gm_avpe[-(1:10),]
colnames(gm_avpe)<-c("Date","GM_AVPE")
gm_avpe<-gm_avpe%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of the data of general merchandise: Capital goods except automotive 
```{r}
gm_capital<-read_excel(here::here("IEAXGC.xls"))
gm_capital<-gm_capital[-(1:10),]
colnames(gm_capital)<-c("Date","GM_capital")
gm_capital<-gm_capital%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of the data of general merchandise: Consumer goods except food and automotive
```{r}
gm_consumer_goods<-read_excel(here::here("IEAXGCG.xls"))
gm_consumer_goods<-gm_consumer_goods[-(1:10),]
colnames(gm_consumer_goods)<-c("Date","GM_consumer_goods")
gm_consumer_goods<-gm_consumer_goods%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of the data of general merchandise: Foods, feeds, and beverages
```{r}
gm_food_feeds_beverages<-read_excel(here::here("IEAXGF.xls"))
gm_food_feeds_beverages<-gm_food_feeds_beverages[-(1:10),]
colnames(gm_food_feeds_beverages)<-c("Date","Gm_food_feeds_beverages")
gm_food_feeds_beverages<-gm_food_feeds_beverages%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Transformation of the data of general merchandise: Industrial supplies and materials
```{r}
gm_industrial_supplies_materials<-read_excel(here::here("IEAXGI.xls"))
gm_industrial_supplies_materials<-gm_industrial_supplies_materials[-(1:10),]
colnames(gm_industrial_supplies_materials)<-c("Date","Gm_industrial_supplies_materials")
gm_industrial_supplies_materials<-gm_industrial_supplies_materials%>%
  mutate(Date=as.numeric(Date))%>%
  mutate(Date=as.Date(Date,origin="1899-12-30"))
```

Join the above 5 data sets
```{r}
Different_types_of_GM<-left_join(gm_avpe,gm_capital)%>%
  left_join(.,gm_consumer_goods)%>%
  left_join(.,gm_food_feeds_beverages)%>%
  left_join(.,gm_industrial_supplies_materials)%>%
  mutate(GM_AVPE=as.numeric(GM_AVPE))%>%
  mutate(GM_capital=as.numeric(GM_capital))%>%
  mutate(GM_consumer_goods=as.numeric(GM_consumer_goods))%>%
  mutate(Gm_food_feeds_beverages=as.numeric(Gm_food_feeds_beverages))%>%
  mutate(Gm_industrial_supplies_materials=as.numeric(Gm_industrial_supplies_materials))

Different_types_of_GM_new<-Different_types_of_GM%>%
  gather(key=Type,value=Value,-Date)%>%
  mutate(Type=forcats::fct_reorder2(Type,Date,Value))%>%
  mutate(Value=as.numeric(Value))
  
```

Create the index to compare the trends among different merchandise
```{r}
Different_types_of_GM_Index<-Different_types_of_GM_new%>%
  group_by(Type)%>%
  mutate(Index=round(100*Value/Value[1],2))%>% 
  ungroup()
```










<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

```{r}
# Missing Value graphs
library(lubridate)
(g12 <- data1 %>%
  filter(!Type %in% c("goods_island", "goods_pr")) %>%
  mutate(missing = ifelse(is.na(Value), "yes", "no")) %>%
  mutate(Date = factor(year(Date))) %>%
  ggplot(., aes(x = location, y = fct_rev(Date), fill = missing)) +
  geom_tile(color = "white") +
  ggtitle("Exports to islands and areas within the United States with NAs added") +
  scale_fill_viridis_d() +
  theme_bw() +
  labs(y = "Year",
       x = "Area Name"))
```

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Analysis and  Results

## The development process of U.S. export data from 1999 to 2021

### Overall data of U.S. export of goods and services

In this part, we want to analyse the development process of U.S. export data.\
Firstly, we want to see the trend of the U.S. export data on a general level, so we combine three data sets of overall export data of goods and exports to see such trend.
```{r}
library(tidyverse)
g1_1<-Overall%>%
  ggplot(aes(Date,Value,color=Name))+
  geom_line()+
  ggtitle("Exports of goods and serives")+
  labs(x="",y="Millions of Dollars") +
  theme_grey(16) +
  theme(legend.title = element_blank())

g1_1
```

From the picture we can see that:\
Data on exports in general have been on an upward trend in both services and goods, with the exception of a few few years.\
We speculate that the fall around 2001 and 2008 may be due to the global financial crisis, and the fall around 2020 may be due to the changes of trade policy towards China and the COVID-19.

### Analysis of General merchandise in the exports of U.S.
General merchandise can be said to be the most important part of goods. It is closely related to people's livelihood. Our research on general merchandise can reflect the living standard and quality of the American people to a certain extent.\
Firstly we want to see the trend of exports of general merchandise and the proportion of general merchandise in goods.
```{r}
g1_2<-Overall_goods_general_merchandise%>%
  ggplot(aes(Date,Value,color=Name))+
  geom_line()+
  ggtitle("Exports of goods")+
  labs(x="",y="Millions of Dollars") +
  theme_grey(16) +
  theme(legend.title = element_blank())

g1_2
```


Now we want to analysis the trend of the data of different types of general merchandise, and we also want see the relationships between them.
```{r}
library(corrplot)
M<-cor(Different_types_of_GM[,2:6])
corrplot(M, method = 'color')

g1_3<-Different_types_of_GM_new%>%
  ggplot(aes(Date,Value,color=Type))+
  geom_line()+
  ggtitle("Exports of different types of general merchandise")+
  labs(x="",y="Millions of Dollars") +
  theme_grey(16) +
  theme(legend.title = element_blank())

g1_3

```

As we can see from the plot:\
(a) The trends of data changes for almost all types general merchandise are the same;\
(b) The industrial supplies and materials and capital are greatly affected by the economic situation in the world;\
(c) The type of food, feeds and beverages is less affected by world economic fluctuations.\
(d) The relationships between those types of merchandise seem to be all positive.\

We can also do the interactive version of this plot to get some intuitive outcomes.
```{r}
library(plotly)
ggplotly(g1_3)
```





We can also use the index to compare the trends of the data among different types of general merchandise. This method is considered more fairly.
```{r}
g1_4<-Different_types_of_GM_Index%>%
  ggplot(aes(Date,Index,color=Type))+
  geom_line()+
  ggtitle("Exports of different types of general merchandise")+
  labs(x="",y="Index") +
  theme_grey(16) +
  theme(legend.title = element_blank())

g1_4

```

From this plot we can conclude that:
(a) The data of industrial supplies and materials had the most dramatic changes in the past two decades;\
(b) Except for type of food, feeds and beverages, all other types of data suffered huge declines around 2020.\








<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

